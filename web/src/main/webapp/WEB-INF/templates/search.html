{% extends("_base.html") %}

{% block title %} 搜索：{{ q }} {% endblock %}

{% block head %}

<script>

var q = $(document.createElement('div')).html('{{ q }}').text();

$(function () {
	$.getJSON('/search.json', {q: q}, function (data) {
		var hits = data.hits;
		var poems = data.results;
		
	}).fail(function() {
		$('.search-error').show();
	}).always(function () {
		$('.search-loading').hide();
	});
});

</script>

{% endblock %}

{% block nav %}
	正在浏览：
	<a href="/" class="x-nav">首页</a>
	»
	<span class="x-nav">搜索：{{ q }}</span>
{% endblock %}

{% block main %}

<div class="uk-grid">
	<div class="uk-width-1-1">
		<div class="search-loading"><i class="uk-icon-spinner uk-icon-spin"></i> 正在搜索……</div>
		<div class="search-error" style="display:none">很抱歉，暂时无法搜索，请稍后再试。</div>
		<div class="search-results">
			<div class="search-results-title"></div>
			<div class="search-results-list"></div>
		</div>
		<div id="poems">
		{% for p in poems %}
			<div class="x-name"><a href="/poem/{{ p.id }}">{{ p.name }}</a></div>
		{% endfor %}
		</div>
	</div>
</div>

{% endblock %}
